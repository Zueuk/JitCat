CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
PROJECT(JitCat)

OPTION(FORCE32 "Force a 32bit compile on 64bit" OFF)

IF (NOT CMAKE_BUILD_TYPE)
 SET(CMAKE_BUILD_TYPE "Release")
ENDIF ()


if(FORCE32)
    SET(CMAKE_C_FLAGS "-m32")
    SET(CMAKE_CXX_FLAGS "-m32 -fvisibility=hidden -fpermissive")
endif()

#if(CMAKE_SIZEOF_VOID_P MATCHES "8" AND NOT(FORCE32))
	#set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "../../lib/$CMAKE_SYSTEM_NAME64/$CMAKE_BUILD_TYPE")
#else()
	#set(CMAKE_LIBRARY_OUTPUT_DIRECTORY "../../lib/$CMAKE_SYSTEM_NAME32/$CMAKE_BUILD_TYPE")
#endif()

if(CMAKE_SIZEOF_VOID_P MATCHES "8" AND NOT(FORCE32))
	set(JITCAT_BITNESS "64")
else()
	set(JITCAT_BITNESS "32")
endif()

include_directories(
    ../../include/jitcat
)

FILE(GLOB JITCAT_SOURCE RELATIVE ${CMAKE_CURRENT_SOURCE_DIR}
    ../../include/jitcat/*.h
    ../../src/jitcat/*.cpp
)

ADD_LIBRARY(JitCat STATIC ${JITCAT_SOURCE})

SET_TARGET_PROPERTIES(JitCat
    PROPERTIES
    COMPILE_FLAGS "-std=c++11 -Wno-write-strings -Wno-unused-function"
    LINK_FLAGS_RELEASE "-Wl,-s,-x"
)


install(TARGETS ${PROJECT_NAME}
		RUNTIME DESTINATION ${CMAKE_SOURCE_DIR}/../../bin/${CMAKE_SYSTEM_NAME}${JITCAT_BITNESS}/${CMAKE_BUILD_TYPE}
		LIBRARY DESTINATION ${CMAKE_SOURCE_DIR}/../../lib/${CMAKE_SYSTEM_NAME}${JITCAT_BITNESS}/${CMAKE_BUILD_TYPE}
		ARCHIVE DESTINATION ${CMAKE_SOURCE_DIR}/../../lib/${CMAKE_SYSTEM_NAME}${JITCAT_BITNESS}/${CMAKE_BUILD_TYPE})